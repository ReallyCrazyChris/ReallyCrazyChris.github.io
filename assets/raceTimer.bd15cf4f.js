import{d as i}from"./index.42812f5f.js";import{u as r}from"./mqtt-vue-hook.es.c8aea688.js";import{u as s}from"./sounds.0e4a8f74.js";const t=r(),a=s(),n=[{label:"1 minute",value:"1",description:"1m - 30s - 10s - Start ",timeSequence:{raceclass:-60,raceprepare:-30,raceready:-10,racestart:0,racetimer:10}},{label:"3 minute",value:"3",description:"3m - 2m - 1m - Start ",timeSequence:{raceclass:-180,raceprepare:-120,raceready:-60,racestart:0,racetimer:10}},{label:"5 minute",value:"5",description:"5m - 4m - 1m - Start ",timeSequence:{raceclass:-60*5,raceprepare:-60*4,raceready:-60,racestart:0,racetimer:10}},{label:"10 minute",value:"10",description:"10m - 9m - 1m - Start ",timeSequence:{raceclass:-60*10,raceprepare:-60*9,raceready:-60,racestart:0,racetimer:10}}],c=[{label:"Papa",value:"P",description:"Prepare",image:"racesignals/papa.svg"},{label:"Italy",value:"I",description:"Rule 30.1",image:"racesignals/italy.svg"},{label:"Zulu",value:"Z",description:"Rule 30.2",image:"racesignals/zulu.svg"},{label:"Uniform",value:"U",description:"Rule 30.3",image:"racesignals/uniform.svg"},{label:"Black",value:"B",description:"Rule 30.4",image:"racesignals/black.svg"}],o=[{label:"Open to All",value:"any",description:"",image:"boatclasses/any.png"},{label:"Optimist",value:"optimist",description:"",image:"boatclasses/optimist.png"},{label:"29er",value:"29er",description:"",image:"boatclasses/29er.png"},{label:"ILCA",value:"ilca",description:"",image:"boatclasses/ilca.png"},{label:"Melges 24",value:"m24",description:"",image:"boatclasses/m24.png"}],l=[{label:"Yankee",value:!0,description:"Wear personal flotation device",image:"racesignals/yankee.svg"},{label:"No Yankee",value:!1,description:"personal flotation devices optional",image:""}],d={label:"5 minute",value:"5",description:"5m - 4m - 1m - Start ",timeSequence:{raceclass:-60*5,raceprepare:-60*4,raceready:-60,racestart:0,racetimer:10}},m={label:"Optimist",value:"optimist",description:"",image:"boatclasses/optimist.png"},h={label:"Papa",value:"P",description:"Prepare",image:"racesignals/papa.svg"},p={label:"Yankee",value:!0,description:"Wear personal flotation device",image:"racesignals/yankee.svg"},u=i("raceTimer",{state:()=>({startTime:void 0,endTime:void 0,raceTime:void 0,raceState:"regattainfo",timerSequenceModel:d,classFlagModel:m,prepareFlagModel:h,yankeeFlagModel:p,timerSequeceOptions:n,classFlagOptions:o,prepareFlagOptions:c,yankeeFlagOptions:l,intervalId:void 0}),actions:{matches(e){return this.raceState==e},publishRaceTransition(e){t.isConnected&&t.publish("racetransition",String(e))},publishRaceTimerState(){t.isConnected&&t.publish("racetimer",JSON.stringify({startTime:this.startTime,raceState:this.raceState,timerSequenceModel:this.timerSequenceModel,classFlagModel:this.classFlagModel,prepareFlagModel:this.prepareFlagModel,yankeeFlagModel:this.yankeeFlagModel}),0,{retain:!0})},racetransitionHandler(e){e=="regattainfo"&&this.regattainfoTransition(),e=="followme"&&this.followmeTransition(),e=="raceclass"&&this.raceclassTransition(),e=="racepostponed"&&this.racepostponedTransition(),e=="racepostponedashore"&&this.racepostponedashoreTransition(),e=="racepostponedtoday"&&this.racepostponedtodayTransition(),e=="racecompleted"&&this.racecompletedTransition(),e=="recallone"&&this.recalloneTransition(),e=="racecontinue"&&this.racecontinueTransition(),e=="recallall"&&this.recallallTransition(),e=="raceabandoned"&&this.raceabandonedTransition(),e=="raceabandonedashore"&&this.raceabandonedashoreTransition(),e=="raceabandonedtoday"&&this.raceabandonedtodayTransition()},mqttUpdate(e){console.log(e),this.raceState!=e.raceState?(this.$patch(e),e.raceState=="regattainfo"&&this.regattainfoTransition(),e.raceState=="raceclass"&&this.raceclassTransition(),e.raceState=="racepostponed"&&this.racepostponedTransition(),e.raceState=="racepostponedashore"&&this.racepostponedashoreTransition(),e.raceState=="racepostponedtoday"&&this.racepostponedtodayTransition(),e.raceState=="recallone"&&this.recalloneTransition(),e.raceState=="recallall"&&this.recallallTransition(),e.raceState=="raceabandoned"&&this.raceabandonedTransition(),e.raceState=="raceabandonedashore"&&this.raceabandonedashoreTransition(),e.raceState=="raceabandonedtoday"&&this.raceabandonedtodayTransition()):this.$patch(e)},regattainfoTransition(){this.stopSequenceTimer(),this.startTime=void 0,this.endTime=void 0,this.raceState="regattainfo",this.publishRaceTimerState()},followmeTransition(){this.stopSequenceTimer(),this.startTime=void 0,this.endTime=void 0,this.raceState="followme",this.publishRaceTimerState(),a.airhorn(1)},raceclassTransition(){this.startTime=Date.now()-this.timerSequenceModel.timeSequence.raceclass*1e3,this.raceTime=0,this.endTime=void 0,this.raceState="raceclass",this.publishRaceTimerState(),a.airhorn(1)},raceprepareTransition(){this.raceState="raceprepare",this.publishRaceTimerState(),a.airhorn(1)},racereadyTransition(){this.raceState="raceready",this.publishRaceTimerState(),a.airhorn(1)},racestartTransition(){this.raceState="racestart",this.publishRaceTimerState(),a.airhorn(1)},racetimerTransition(){this.raceState="racetimer",this.publishRaceTimerState()},startSequenceTimer(){clearInterval(this.intervalId),setTimeout(()=>{this.intervalId=setInterval(()=>{Number.isInteger(this.startTime)&&(this.raceTime=Math.round((Date.now()-this.startTime)/1e3)),this.startTime!=null&&this.raceState=="raceclass"&&this.raceTime>=this.timerSequenceModel.timeSequence.raceprepare&&this.raceprepareTransition(),this.startTime!=null&&this.raceState=="raceprepare"&&this.raceTime>=this.timerSequenceModel.timeSequence.raceready&&this.racereadyTransition(),this.startTime!=null&&this.raceState=="raceready"&&this.raceTime>=this.timerSequenceModel.timeSequence.racestart&&this.racestartTransition(),this.startTime!=null&&this.raceState=="racestart"&&this.raceTime>=this.timerSequenceModel.timeSequence.racetimer&&this.racetimerTransition()},1e3)},1e3-new Date().getMilliseconds())},stopSequenceTimer(){this.startTime=void 0,this.endTime=Date.now()},racepostponedTransition(){this.stopSequenceTimer(),this.raceState="racepostponed",this.publishRaceTimerState(),a.airhorn(2)},racepostponedashoreTransition(){this.stopSequenceTimer(),this.raceState="racepostponedashore",this.publishRaceTimerState(),a.airhorn(2)},racepostponedtodayTransition(){this.stopSequenceTimer(),this.raceState="racepostponedtoday",this.publishRaceTimerState(),a.airhorn(2)},recalloneTransition(){this.raceState="recallone",this.publishRaceTimerState(),a.airhorn(1)},racecontinueTransition(){this.raceState="racetimer",this.publishRaceTimerState()},recallallTransition(){this.stopSequenceTimer(),this.raceState="recallall",this.publishRaceTimerState(),a.airhorn(2)},racecompletedTransition(){this.stopSequenceTimer(),this.raceState="regattainfo",this.publishRaceTimerState()},raceabandonedTransition(){this.stopSequenceTimer(),this.raceState="raceabandoned",this.publishRaceTimerState(),a.airhorn(3)},raceabandonedashoreTransition(){this.stopSequenceTimer(),this.raceState="raceabandonedashore",this.publishRaceTimerState(),a.airhorn(3)},raceabandonedtodayTransition(){this.stopSequenceTimer(),this.raceState="raceabandonedtoday",this.publishRaceTimerState(),a.airhorn(3)}}}),T=u(),g=()=>T;export{g as u};
